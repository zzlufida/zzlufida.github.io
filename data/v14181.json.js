window.repositoryObject = {"columns_custom_fields":[],"relations_custom_fields":[],"triggers_custom_fields":[],"object_id":"v14181","name":"VW_IM_ordercostanalyse","subtype":"VIEW","is_user_defined":false,"description":null,"script":"create view VW_IM_ordercostanalyse\r\nas \r\nselect  t.*,\r\n\tim_credit_order.ccreditcode,--信用证号\r\n\tim_credit_order.dcreditdate,--开证日期\r\n\trdrecord.ddate,--实际入库日期\r\n\tim_invoice_sw.finvoicenatmoney,--买入金额\r\n\tim_feeinvoice.fcustomnattax ,--关税发票金额\r\n\tim_feeinvoice.faddnattax,--关税发票金额\r\n\tim_invoice_order.ccode as cinvoiceccode ,--发票编号\r\n\tim_invoice_order.ctransordercode--提单号\r\n\tfrom \r\n\t(\r\n\t\tselect\tim_order.ccode as cordercode,--进口订单编号\r\n\tim_order.cmaker,\t\r\n\t\tim_order.dplanarrivaldate,--要求到货日期\t\r\n\t\texpenseitem.cexpname, --费用项目\r\n\t\tsum(isnull(im_invoicedetail.fnattaxmoney,0)) as ffeenattaxmoney --费用\r\n\t\tfrom im_order\r\n\t\tleft join im_invoice on im_invoice.cgeneralordercode=im_order.ccode and (im_invoice.cinvoicetypecode ='3' or im_invoice.cinvoicetypecode ='4' )\r\n\t\tleft join im_invoicedetail on im_invoicedetail.id=im_invoice.id  \r\n\t\tleft join expenseitem on expenseitem.cexpcode = im_invoicedetail.cexpcode\t\r\n\t\tgroup by im_order.ccode,expenseitem.cexpname,im_order.cmaker\r\n\t\t,im_order.dplanarrivaldate\r\n\t) as t\r\n\tleft join (\r\n\t\t\tselect im_credit1.cgeneralordercode,im_credit1.dcreditdate, im_credit1.ccreditcode from im_credit im_credit1\r\n\t\t\twhere\r\n-- \t\t\t\t ddate=(\r\n-- \t\t\t\t   select max(im_credit2.ddate) from im_credit im_credit2 \r\n-- \t\t\t\t   where im_credit2.cgeneralordercode = im_credit1.cgeneralordercode  \r\n-- \t\t\t\t\t) \r\n-- \t\t\t\tand\r\n\t\t\t\t id=(\r\n\t\t\t\t  select max(im_credit2.id) from im_credit im_credit2 \r\n\t\t\t\t   where im_credit2.cgeneralordercode = im_credit1.cgeneralordercode  \r\n\t\t\t\t\t)\r\n\t\t\t\t \r\n\t) im_credit_order on im_credit_order.cgeneralordercode = t.cordercode \t\t\r\n \t--left join im_invoice on im_invoice.cgeneralordercode = t.cordercode and im_invoice.cvouchtype =N'IM90' \r\n\tleft join (\r\n\t\t\tselect invoice1.ccode,invoice1.cgeneralordercode,invoice1.ctransordercode,invoice1.ddate from im_invoice invoice1\r\n-- \t\t\twhere ddate=(\r\n-- \t\t\t\t   select max(invoice2.ddate) from im_invoice invoice2 \r\n-- \t\t\t\t   where invoice2.cgeneralordercode=invoice1.cgeneralordercode  and cvouchtype =N'IM90'\r\n-- \t\t\t\t    ) and cvouchtype =N'IM90'\r\n-- \t\t\t\tand\r\n\t\t\twhere id=(\r\n\t\t\t\t   select max(invoice2.id) from im_invoice invoice2 \r\n\t\t\t\t   where invoice2.cgeneralordercode=invoice1.cgeneralordercode  and cvouchtype =N'IM90'\r\n\t\t\t\t    ) and cvouchtype =N'IM90'\r\n\r\n\t\t  ) im_invoice_order \r\n\t\t    on im_invoice_order.cgeneralordercode = t.cordercode\r\n\tleft join (\r\n\t\t   select  max(ddate)as ddate,cordercode from rdrecord01 rdrecord \r\n\t\t   where (RdRecord.csource=N'进口发票' or RdRecord.csource=N'进口订单' )\r\n\t\tand\r\n\t\t\tid=(\r\n\t\t\t\t   select max(rdrecord2.id) from rdrecord01 rdrecord2 \r\n\t\t\t\t   where rdrecord2.cordercode=rdrecord.cordercode \r\n\t\t\t\t) \r\n\t\t   group by cordercode\r\n\t\t) RdRecord \r\n\t\t   on RdRecord.cordercode = t.cordercode \r\n\tleft join (\r\n\t\tselect \r\n\t\tim_invoice.cgeneralordercode,\r\n\t\t--sum(case when isnull(cinvoicetypecode,0) =0 then isnull(im_invoicedetail.fnatmoney,0) else 0  end) as finvoicenatmoney ,--商务发票金额(买入金额),\r\n\t\tsum(case when isnull(cinvoicetypecode,0) =1 then isnull(im_invoicedetail.fnattax,0) else 0 end) as fcustomnattax ,--关税发票金额\r\n\t\tsum(case when isnull(cinvoicetypecode,0) =2 then isnull(im_invoicedetail.fnattax,0) else 0 end) as faddnattax --增值税发票金额\r\n\t\tfrom im_invoice \t\r\n\t\tinner join im_invoicedetail on im_invoicedetail.id = im_invoice.id \r\n   \t       --and (im_invoice.cvouchtype =N'IM92' or im_invoice.cvouchtype =N'IM93') \r\n\t\tgroup by im_invoice.cgeneralordercode\r\n\t\t   ) \r\n\t\tim_feeinvoice on im_feeinvoice.cgeneralordercode = t.cordercode\r\n\r\n\tleft join (\r\n\t\tselect \r\n\t\tim_invoice.cgeneralordercode,\r\n\t\tsum(case when isnull(cinvoicetypecode,null) =0 then isnull(im_invoicedetail.fnatmoney,null) else 0  end) as finvoicenatmoney --商务发票金额(买入金额)\r\n\t\tfrom im_invoice \t\r\n\t\tinner join im_invoicedetail on im_invoicedetail.id = im_invoice.id \r\n   \t        --and (im_invoice.cvouchtype =N'IM90' or im_invoice.cvouchtype =N'IM91')\r\n\t\tgroup by im_invoice.cgeneralordercode\r\n\t\t   ) \r\n\t\tim_invoice_sw on im_invoice_sw.cgeneralordercode = t.cordercode","summary":[{"field":"Documentation","value":{"_type":"link","name":"U8V16.5数据字典","id":"d6"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"VW_IM_ordercostanalyse"},{"field":"Type","value":"View"}],"columns":[{"id":"column-419295","object_id":"column-419295","name":"cordercode","name_without_path":"cordercode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"30","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419296","object_id":"column-419296","name":"cmaker","name_without_path":"cmaker","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"20","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419297","object_id":"column-419297","name":"dplanarrivaldate","name_without_path":"dplanarrivaldate","description":null,"is_pk":false,"is_identity":false,"data_type":"datetime","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419298","object_id":"column-419298","name":"cexpname","name_without_path":"cexpname","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"20","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419299","object_id":"column-419299","name":"ffeenattaxmoney","name_without_path":"ffeenattaxmoney","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419300","object_id":"column-419300","name":"ccreditcode","name_without_path":"ccreditcode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"40","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419301","object_id":"column-419301","name":"dcreditdate","name_without_path":"dcreditdate","description":null,"is_pk":false,"is_identity":false,"data_type":"datetime","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419302","object_id":"column-419302","name":"ddate","name_without_path":"ddate","description":null,"is_pk":false,"is_identity":false,"data_type":"datetime","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419303","object_id":"column-419303","name":"finvoicenatmoney","name_without_path":"finvoicenatmoney","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419304","object_id":"column-419304","name":"fcustomnattax","name_without_path":"fcustomnattax","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419305","object_id":"column-419305","name":"faddnattax","name_without_path":"faddnattax","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419306","object_id":"column-419306","name":"cinvoiceccode","name_without_path":"cinvoiceccode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"30","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-419307","object_id":"column-419307","name":"ctransordercode","name_without_path":"ctransordercode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"30","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]}],"relations":[],"triggers":[],"unique_keys":[],"dependencies":null,"imported_at":"2024-07-15 13:47"};