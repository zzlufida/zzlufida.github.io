window.repositoryObject = {"columns_custom_fields":[],"relations_custom_fields":[],"triggers_custom_fields":[],"object_id":"v14230","name":"vwContractExecJSRP","subtype":"VIEW","is_user_defined":false,"description":null,"script":"----------合同总金额\r\nCREATE View vwContractExecJSRP\r\nas \r\nSELECT  C.strContractID,IV.dblTotalCurrency, IV.dblTotalQuantity,\r\n\t--执行金额\r\n\t(Case   When (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'1') then EI.dblExecCurrency\r\n                When (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'0') then CI.dblExecCurrency \r\n\t\tWhen C.strContractKind like N'采购类合同' then V2.decExecRateMoney\r\n\t\tWhen C.strContractKind like N'销售类合同' then V3.decExecRateMoney End) As dblExecCurrency,\r\n\t--结算金额\r\n\t(Case When C.strContractKind like N'应%' then CI.dblExecCurrency \r\n\t\telse 0 End) As dblBalanceCurrency,\r\n\r\n\t(Case   When (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'1') then EI.decExecCount\r\n\t\tWhen (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'0') then CI.dblExecQuantity\r\n\t\tWhen C.strContractKind like  N'采购类合同' then V2.decExecCount\r\n\t\tWhen C.strContractKind like  N'销售类合同' then V3.decExecCount End) As dblExecQuantity,\r\n\t(Case When C.strContractKind like N'应%' then CI2.decRateMoneyAPAR\r\n\t\tWhen C.strContractKind like  N'采购类合同' then V2.decRateMoneyAPAR\r\n\t\tWhen C.strContractKind like  N'销售类合同' then V3.decRateMoneyAPAR End) As dblAPARCurrency,\r\n\tM.dblPreAPARCurrency\r\nFROM CM_Contract_B C\r\n\tinner join CM_SystemSet on CM_SystemSet.cName=N'bUseExecBill'\r\n\tINNER JOIN CM_Contract_Main M ON C.strContractID=M.strContractID\r\n\tLeft JOIN \r\n\t(\r\n\t    select cContractID,sum(decCount) as decExecCount,sum(decRateMoney) as dblExecCurrency\r\n            from CM_EffectExecuteData group by cContractID\r\n\r\n\t)EI On C.strContractID = EI.cContractID\r\n\tleft JOIN (\r\n\t\tselect GUID,sum(isnull(dblSum,0)) AS dblTotalCurrency,sum(isnull(dblQuantity,0)) AS dblTotalQuantity\r\n\t\tfrom CM_Contract_Item_B where intEnd=1 and intFlag<>1 group by GUID) IV ON IV.GUID=C.GUID\r\n\t        left join\r\n               (\r\n\t\t\tselect distinct b.cContractID, sum(isnull(bs.decRateMoney,0)) as dblExecCurrency, sum(isnull(bs.decCount,0)) as dblExecQuantity\r\n\t\t\tfrom CM_Balance b left join CM_Balances bs on b.cBalanceID=bs.cBalanceID\r\n\t                where isnull (b.dtAuditeDate, N'') <> N''\r\n\t\t\tgroup by b.cContractID\r\n\t\t) CI On C.strContractID=CI.cContractID And C.strContractKind like N'应%'\r\n\tleft join(\tselect distinct b2.cContractID,sum(isnull(bd2.decMoney,0)) as decRateMoneyAPAR\r\n\t\t\tfrom CM_Balance b2\r\n\t\t\tleft join CM_BalanceDetail bd2 on b2.cBalanceID=bd2.cBalanceID\r\n\t\t\twhere isnull(bd2.cProcStyle,'') not like 'XJ%' or (bd2.cProcStyle like 'XJ%' and bd2.cCancelNo in (select strSpare3 from CM_Balance))\r\n\t\t\tgroup by b2.cContractID\r\n\t\t) CI2 On C.strContractID=CI2.cContractID And C.strContractKind like N'应%'\r\n\r\n\tLEFT JOIN (Select cContractID,Sum(decCount) As decExecCount,\r\n\t\tSum(decRateMoney) As decExecRateMoney,Sum(decRateMoneyAPAR) As decRateMoneyAPAR\r\n\tfrom CM_ExecInterface Where cOrderType=N'采购订单' And cFlag=1 Group By cContractID) V2\r\n\tOn V2.cContractID=C.strContractID And C.strContractKind=N'采购类合同'\r\n\tLEFT JOIN (Select cContractID,Sum(decCount) As decExecCount,\r\n\t\tSum(decRateMoney) As decExecRateMoney,Sum(decRateMoneyAPAR) As decRateMoneyAPAR\r\n\tfrom CM_ExecInterface Where cOrderType=N'销售订单' And cFlag=1 Group By cContractID) V3\r\n\tOn V3.cContractID=C.strContractID And C.strContractKind=N'销售类合同'\r\nUNION ALL\r\nSELECT  C.strContractID,IV.dblTotalCurrency,IV.dblTotalQuantity, \r\n\t(Case   When (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'1' )then EI.dblExecCurrency\r\n\t\tWhen (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'0' )then CI.dblExecCurrency\r\n\t\tWhen C.strContractKind like N'采购类合同' then V2.decExecRateMoney\r\n\t\tWhen C.strContractKind like N'销售类合同' then V3.decExecRateMoney End) As dblExecCurrency,\r\n\t\r\n\t(Case When C.strContractKind like N'应%' then CI.dblExecCurrency \r\n\t\telse 0 End) As dblBalanceCurrency,\t\r\n\r\n\t(Case   When (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'1') then EI.decExecCount\r\n\t\tWhen (C.strContractKind like N'应%' and CM_SystemSet.cValue=N'0') then CI.dblExecQuantity\r\n\t\tWhen C.strContractKind like  N'采购类合同' then V2.decExecCount\r\n\t\tWhen C.strContractKind like  N'销售类合同' then V3.decExecCount End) As dblExecQuantity,\r\n\t(Case When C.strContractKind like N'应%' then CI2.decRateMoneyAPAR\r\n\t\tWhen C.strContractKind like  N'采购类合同' then V2.decRateMoneyAPAR\r\n\t\tWhen C.strContractKind like  N'销售类合同' then V3.decRateMoneyAPAR End) As dblAPARCurrency,\r\n\tM.dblPreAPARCurrency\r\nFROM CM_Contract_C C\r\n\tinner join CM_SystemSet on CM_SystemSet.cName=N'bUseExecBill'\r\n\tINNER JOIN CM_Contract_Main M ON C.strContractID=M.strContractID\r\n\tLeft JOIN \r\n\t(\r\n\t    select cContractID,sum(decCount) as decExecCount,sum(decRateMoney) as dblExecCurrency\r\n            from CM_EffectExecuteData group by cContractID\r\n\r\n\t)EI On C.strContractID = EI.cContractID\r\n\tleft JOIN (\tselect GUID,sum(isnull(dblSum,0)) AS dblTotalCurrency,sum(isnull(dblQuantity,0)) AS dblTotalQuantity\r\n\t\tfrom CM_Contract_Item_C where intEnd=1 and intFlag<>1 group by GUID) IV ON IV.GUID=C.GUID\r\n\tleft join(select distinct b.cContractID, \r\n\t\tsum(isnull(bs.decRateMoney,0)) as dblExecCurrency, sum(isnull(bs.decCount,0)) as dblExecQuantity\r\n\t\tfrom CM_Balance b\r\n\t\t\tleft join CM_Balances bs on b.cBalanceID=bs.cBalanceID\r\n\t\t\tgroup by b.cContractID\r\n\t\t) CI On C.strContractID=CI.cContractID And C.strContractKind like N'应%'\r\n\tleft join(\tselect distinct b2.cContractID,sum(isnull(bd2.decMoney,0)) as decRateMoneyAPAR\r\n\t\t\tfrom CM_Balance b2\r\n\t\t\tleft join CM_BalanceDetail bd2 on b2.cBalanceID=bd2.cBalanceID\r\n\t\t\twhere isnull(bd2.cProcStyle,'') not like 'XJ%' or (bd2.cProcStyle like 'XJ%' and bd2.cCancelNo in (select strSpare3 from CM_Balance))\r\n\t\t\tgroup by b2.cContractID\r\n\t\t) CI2 On C.strContractID=CI2.cContractID And C.strContractKind like N'应%'\r\n\tLEFT JOIN (Select cContractID,Sum(decCount) As decExecCount,\r\n\t\tSum(decRateMoney) As decExecRateMoney,Sum(decRateMoneyAPAR) As decRateMoneyAPAR\r\n\tfrom CM_ExecInterface Where cOrderType=N'采购订单' And cFlag=1 Group By cContractID) V2\r\n\tOn V2.cContractID=C.strContractID And C.strContractKind=N'采购类合同'\r\n\tLEFT JOIN (Select cContractID,Sum(decCount) As decExecCount,\r\n\t\tSum(decRateMoney) As decExecRateMoney,Sum(decRateMoneyAPAR) As decRateMoneyAPAR\r\n\tfrom CM_ExecInterface Where cOrderType=N'销售订单' And cFlag=1 Group By cContractID) V3\r\n\tOn V3.cContractID=C.strContractID And C.strContractKind=N'销售类合同'\r\nWhere\tIsNull(C.strEndCaseDate , N'') <> N''","summary":[{"field":"Documentation","value":{"_type":"link","name":"U8V16.5数据字典","id":"d6"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"vwContractExecJSRP"},{"field":"Type","value":"View"}],"columns":[{"id":"column-422704","object_id":"column-422704","name":"strContractID","name_without_path":"strContractID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"64","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-422705","object_id":"column-422705","name":"dblTotalCurrency","name_without_path":"dblTotalCurrency","description":null,"is_pk":false,"is_identity":false,"data_type":"float","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-422706","object_id":"column-422706","name":"dblTotalQuantity","name_without_path":"dblTotalQuantity","description":null,"is_pk":false,"is_identity":false,"data_type":"float","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-422707","object_id":"column-422707","name":"dblExecCurrency","name_without_path":"dblExecCurrency","description":null,"is_pk":false,"is_identity":false,"data_type":"float","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-422708","object_id":"column-422708","name":"dblBalanceCurrency","name_without_path":"dblBalanceCurrency","description":null,"is_pk":false,"is_identity":false,"data_type":"numeric","data_length":"38, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-422709","object_id":"column-422709","name":"dblExecQuantity","name_without_path":"dblExecQuantity","description":null,"is_pk":false,"is_identity":false,"data_type":"float","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-422710","object_id":"column-422710","name":"dblAPARCurrency","name_without_path":"dblAPARCurrency","description":null,"is_pk":false,"is_identity":false,"data_type":"float","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-422711","object_id":"column-422711","name":"dblPreAPARCurrency","name_without_path":"dblPreAPARCurrency","description":null,"is_pk":false,"is_identity":false,"data_type":"float","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]}],"relations":[],"triggers":[],"unique_keys":[],"dependencies":null,"imported_at":"2024-07-15 13:47"};