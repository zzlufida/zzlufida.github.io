window.repositoryObject = {"columns_custom_fields":[],"relations_custom_fields":[],"triggers_custom_fields":[],"object_id":"v10230","name":"CM_QContractProjectIncomeCostPerPeriod","subtype":"VIEW","is_user_defined":false,"description":null,"script":"Create              View CM_QContractProjectIncomeCostPerPeriod\r\nas\r\n\r\n --应收类合同\r\n select C.cClassCode,C.cClassName,R.cContractID as strContractID,N'' as cItemCode,\r\n        iYear,iPeriod,\r\n        IsNull(decRateMoney,0) As dblInComeOrig,--收入原币\r\n        IsNull(decRateBenBiMoney,0) As dblInCome,--收入本币\r\n\tIsNull(dblCost,0) as dblCostOrig,--成本原币\r\n        IsNull(dblCost,0) As dblCost, --成本本币\r\n        (IsNull(decRateBenBiMoney,0)-IsNull(dblCost,0)) as dblProfitOrig,--毛利原币\r\n        (IsNull(decRateBenBiMoney,0)-IsNull(dblCost,0)) As dblProfit--毛利本币\r\n from CM_ProjectClass C\r\n Left Join CM_ProjectContrastRelation R On C.cClassCode=R.cClassCode\r\n inner join (select strContractID from CM_Contract_B where strContractKind=N'应收类合同'\r\n             and (istatus=1 or istatus=2) \r\n            )CON on R.cContractID=CON.strContractID\r\n Left Join (select (case when V.strContractID is null then B.strContractID else V.strContractID end) as strContractID,\r\n                   (case when V.iJsYear is null then B.iYear else V.iJsYear end) as iYear,\r\n\t           (case when V.iJsPeriod is null then B.iPeriod else V.iJsPeriod end) as iPeriod,\r\n                   decRateMoney,decRateBenBiMoney,dblCost\r\n            from CM_QContractJSMoneyPerMonth V\r\n            full Join (select strContractID,cast(right(db_name(),4) as int) iYear,iPeriod,IsNull(Sum(iamount),0) As dblCost \r\n\t\t       from (select IC.strContractID,strCorrSource,strCorrItemID,strXMDL from CM_Contract_Item_B IC\r\n\t\t\t     inner join CM_Contract_B CC on IC.GUID=CC.GUID\r\n\t\t             where (istatus=1 or istatus=2) \r\n\t\t            ) I\r\n\t\t       Left Join CM_QItemCostFS E On I.strCorrItemID=E.cItemCode\r\n\t\t       where strCorrSource=N'项目' And Left(I.strXMDL,2)=N'97' and right(strXMDL,1)=N'1' \r\n\t\t       Group by strContractID,iPeriod having IsNull(Sum(iamount),0)<>0\r\n\t\t      ) B On V.strContractID=B.strContractID and B.iYear=V.iJsYear and B.iPeriod=V.iJsPeriod\r\n            )IC on R.cContractID=IC.strContractID\r\n\r\n union all \r\n --应付类合同\r\n select C.cClassCode,C.cClassName,R.cContractID as strContractID,N'' as cItemCode,\r\n V.iJsYear as iYear,\r\n V.iJsPeriod as iPeriod,\r\n null as dblInComeOrig,--收入原币\r\n null As dblInCome,--收入本币\r\n isnull(V.decRateMoney,0) As dblCostOrig,--成本原币\r\n IsNull(V.decRateBenBiMoney,0) As dblCost,--成本本币\r\n (-IsNull(V.decRateMoney,0)) As dblProfitOrig,--毛利原币\r\n (-IsNull(V.decRateBenBiMoney,0)) As dblProfit--毛利本币\r\n from CM_ProjectClass C\r\n Left Join CM_ProjectContrastRelation R On C.cClassCode=R.cClassCode\r\n inner join (select strContractID from CM_Contract_B where strContractKind=N'应付类合同'\r\n             and (istatus=1 or istatus=2) \r\n            )CON on R.cContractID=CON.strContractID\r\n Left Join CM_QContractJSMoneyPerMonth V On R.cContractID=V.strContractID\r\n\r\n union all\r\n --采购类合同\r\n select C.cClassCode,C.cClassName,R.cContractID as strContractID,N'' as cItemCode,\r\n B.iYear,\r\n B.iPeriod,\r\n null as dblInComeOrig,--收入原币\r\n null As dblInCome,--收入本币\r\n isnull(B.dblCostOrig,0) as dblCostOrig, --成本原币\r\n IsNull(B.dblCost,0) As dblCost,----成本本币\r\n -IsNull(B.dblCostOrig,0) As dblProfitOrig,--毛利原币\r\n -IsNull(B.dblCost,0) As dblProfit--毛利本币\r\n from CM_ProjectClass C\r\n Left Join CM_ProjectContrastRelation R On C.cClassCode=R.cClassCode\r\n inner Join (select strContractID,strContractKind from CM_Contract_B\r\n             where strContractKind=N'采购类合同'\r\n\t\tand (istatus=1 or istatus=2) \r\n            ) V On R.cContractID=V.strContractID\r\n Left Join (select strContractID,year(dPBVDate) as iYear,month(dPBVDate) as iPeriod,sum(iOriSum) as dblCostOrig,Sum(iSum) As dblCost \r\n\t    From CM_QTrackPuBill\r\n            Group by strContractID,year(dPBVDate),month(dPBVDate)\r\n            ) B On R.cContractID=B.strContractID\r\n\r\n\r\n Union all \r\n --销售类合同\r\n select C.cClassCode,C.cClassName,R.cContractID as strContractID,N'' as cItemCode,\r\n B.iYear,\r\n B.iPeriod,\r\n IsNull(B.dblInComeOrig,0) As dblInComeOrig,--收入原币 \r\n IsNull(B.dblInCome,0) As dblInCome,--收入本币\r\n null as dblCostOrig,--成本原币\r\n null As dblCost,--成本本币\r\n IsNull(B.dblInComeOrig,0) As dblProfitOrig,--毛利原币\r\n IsNull(B.dblInCome,0) As dblProfit--毛利本币\r\n from CM_ProjectClass C\r\n Left Join CM_ProjectContrastRelation R On C.cClassCode=R.cClassCode\r\n inner Join (select strContractID,strContractKind from CM_Contract_B\r\n             where strContractKind=N'销售类合同'\r\n             and (istatus=1 or istatus=2)\r\n            ) V On R.cContractID=V.strContractID\r\nLeft Join (select strContractID,year(dDate) as iYear,month(dDate) as iPeriod,sum(iSum) as dblInComeOrig,Sum(iNatSum) As dblInCome \r\n\t   From CM_QTrackSaBill\r\n           Group by strContractID,year(dDate),month(dDate)\r\n           ) B On R.cContractID=B.strContractID\r\n\r\n Union all\r\n\r\n --自建项目\r\n select C.cClassCode,C.cClassName,N'' as strContractID,R.cItemCode,\r\n cast(right(db_name(),4) as int) iYear,\r\n B.iPeriod,\r\n IsNull(dblInCome,0) as dblInComeOrig,\r\n IsNull(dblInCome,0) As dblInCome,\r\n IsNull(dblCost,0) as dblCostOrig,\r\n IsNull(dblCost,0) As dblCost,\r\n (IsNull(dblInCome,0)-IsNull(dblCost,0)) as dblProfitOrig,\r\n (IsNull(dblInCome,0)-IsNull(dblCost,0)) As dblProfit\r\n from CM_ProjectClass C\r\n Left Join CM_ProjectContrastRelation R On C.cClassCode=R.cClassCode\r\n Left Join CM_QItemIncomeCostFS B On R.cItemCode=B.cItemCode \r\n where isnull(R.cItemCode,N'')<>N'' and not(IsNull(dblInCome,0)=0 and IsNull(dblCost,0)=0)","summary":[{"field":"Documentation","value":{"_type":"link","name":"U8V16.5数据字典","id":"d6"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"CM_QContractProjectIncomeCostPerPeriod"},{"field":"Type","value":"View"}],"columns":[{"id":"column-178640","object_id":"column-178640","name":"cClassCode","name_without_path":"cClassCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"12","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178641","object_id":"column-178641","name":"cClassName","name_without_path":"cClassName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"40","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178642","object_id":"column-178642","name":"strContractID","name_without_path":"strContractID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"600","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178643","object_id":"column-178643","name":"cItemCode","name_without_path":"cItemCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"60","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178644","object_id":"column-178644","name":"iYear","name_without_path":"iYear","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178645","object_id":"column-178645","name":"iPeriod","name_without_path":"iPeriod","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178646","object_id":"column-178646","name":"dblInComeOrig","name_without_path":"dblInComeOrig","description":null,"is_pk":false,"is_identity":false,"data_type":"numeric","data_length":"38, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178647","object_id":"column-178647","name":"dblInCome","name_without_path":"dblInCome","description":null,"is_pk":false,"is_identity":false,"data_type":"numeric","data_length":"38, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178648","object_id":"column-178648","name":"dblCostOrig","name_without_path":"dblCostOrig","description":null,"is_pk":false,"is_identity":false,"data_type":"numeric","data_length":"38, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178649","object_id":"column-178649","name":"dblCost","name_without_path":"dblCost","description":null,"is_pk":false,"is_identity":false,"data_type":"numeric","data_length":"38, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178650","object_id":"column-178650","name":"dblProfitOrig","name_without_path":"dblProfitOrig","description":null,"is_pk":false,"is_identity":false,"data_type":"numeric","data_length":"38, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-178651","object_id":"column-178651","name":"dblProfit","name_without_path":"dblProfit","description":null,"is_pk":false,"is_identity":false,"data_type":"numeric","data_length":"38, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]}],"relations":[],"triggers":[],"unique_keys":[],"dependencies":null,"imported_at":"2024-07-15 13:47"};