window.repositoryObject = {"columns_custom_fields":[],"relations_custom_fields":[],"triggers_custom_fields":[],"object_id":"v11767","name":"NE_VouchOverBudgetInfo_View","subtype":"VIEW","is_user_defined":false,"description":null,"script":"create view NE_VouchOverBudgetInfo_View    \r\nas   \r\nSELECT  NE_OperationType.TypeID AS TypeID ,\r\n        '' AS CostItemID ,\r\n        CONVERT(NVARCHAR(100), NE_LoanVouch_Sub.ID) AS SubVouchID ,\r\n        NE_LoanVouch.AuditorID ,\r\n        CONVERT(NVARCHAR(100), NE_LoanVouch.ID) AS VouchID ,\r\n        NE_LoanVouch.OperationTypeCode ,\r\n        '0' AS flag ,\r\n        foreigncurrency.bcal ,\r\n        NE_LoanVouch.ExchangeRate ,\r\n        NE_OperationType.Name AS OperationType ,\r\n        NE_LoanVouch.Code AS VouchCode ,\r\n        NE_LoanVouch.LoanDate AS VouchDate , \r\n\t\t--头用途\r\n        NE_LoanVouch.Used AS HeadUsed ,\r\n        NE_LoanVouch_Sub.BudgetItemID ,\r\n        NE_LoanVouch_Sub.Port1 ,\r\n        NE_LoanVouch_Sub.Port1Value ,\r\n        NE_LoanVouch_Sub.Port2 ,\r\n        NE_LoanVouch_Sub.Port2Value ,\r\n        NE_LoanVouch_Sub.Port3 ,\r\n        NE_LoanVouch_Sub.Port3Value ,\r\n        NE_LoanVouch_Sub.Port4 ,\r\n        NE_LoanVouch_Sub.Port4Value ,\r\n        NE_LoanVouch_Sub.Port5 ,\r\n        NE_LoanVouch_Sub.Port5Value ,\r\n        NE_LoanVouch_Sub.Port6 ,\r\n        NE_LoanVouch_Sub.Port6Value ,\r\n        bg_v_ctrlitem.cItemName AS BudgetItemName ,\r\n\t\t--行部门名称\r\n        department.cDepName AS SubcDepName ,\r\n\t\t--行人员名称\r\n        person.cpersonname AS SubPersonName ,  \r\n\t\t--行人员编码\r\n        NE_LoanVouch_Sub.BorrowerID AS SubPersonCode ,\r\n\t\t--行部门编码\r\n        NE_LoanVouch_Sub.SpreadDeptID AS SubDeptID ,\r\n        NE_LoanVouch_Sub.ItemClassID ,\r\n        fitem.cItem_Name AS ItemClassName ,\r\n        NE_LoanVouch_Sub.ItemID ,\r\n        fitems.cItemName AS ItemName ,  \r\n\t\t--金额\r\n        CASE WHEN ( bg_v_ctrlitem.cForeignCurrency = NE_LoanVouch.Currency )\r\n             THEN ( CASE WHEN ISNULL(NE_LoanVouch_Sub.FactMoney, 0) = 0\r\n                         THEN NE_LoanVouch_Sub.PlanMoney\r\n                         ELSE NE_LoanVouch_Sub.FactMoney\r\n                    END )\r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1\r\n                         THEN CAST(( CASE WHEN ISNULL(NE_LoanVouch_Sub.FactMoney,\r\n                                                      0) = 0\r\n                                          THEN NE_LoanVouch_Sub.PlanMoney\r\n                                          ELSE NE_LoanVouch_Sub.FactMoney\r\n                                     END ) * NE_LoanVouch.ExchangeRate AS MONEY)\r\n                         ELSE CAST(( CASE WHEN ISNULL(NE_LoanVouch_Sub.FactMoney,\r\n                                                      0) = 0\r\n                                          THEN NE_LoanVouch_Sub.PlanMoney\r\n                                          ELSE NE_LoanVouch_Sub.FactMoney\r\n                                     END ) / NE_LoanVouch.ExchangeRate AS MONEY)\r\n                    END )\r\n        END dblMoney ,\r\n        NE_LoanVouch.BudgetState ,\r\n        NE_LoanVouch.OverBudget ,\r\n        NE_LoanVouch.OverBudgetAuditor ,\r\n        NE_LoanVouch.OverBudgetAuditDate ,\r\n        NE_LoanVouch.OverBudgetAuditDesc ,\r\n\t\t--无税金额 借款单默认等于金额\r\n        CASE WHEN ( bg_v_ctrlitem.cForeignCurrency = NE_LoanVouch.Currency )\r\n             THEN ( CASE WHEN ISNULL(NE_LoanVouch_Sub.FactMoney, 0) = 0\r\n                         THEN NE_LoanVouch_Sub.PlanMoney\r\n                         ELSE NE_LoanVouch_Sub.FactMoney\r\n                    END )\r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1\r\n                         THEN CAST(( CASE WHEN ISNULL(NE_LoanVouch_Sub.FactMoney,\r\n                                                      0) = 0\r\n                                          THEN NE_LoanVouch_Sub.PlanMoney\r\n                                          ELSE NE_LoanVouch_Sub.FactMoney\r\n                                     END ) * NE_LoanVouch.ExchangeRate AS MONEY)\r\n                         ELSE CAST(( CASE WHEN ISNULL(NE_LoanVouch_Sub.FactMoney,\r\n                                                      0) = 0\r\n                                          THEN NE_LoanVouch_Sub.PlanMoney\r\n                                          ELSE NE_LoanVouch_Sub.FactMoney\r\n                                     END ) / NE_LoanVouch.ExchangeRate AS MONEY)\r\n                    END )\r\n        END NontaxAmount , \r\n \t\t\r\n\t\t--头部门编码 \r\n        NE_LoanVouch.SpreadDeptID AS HeadDeptID , \r\n\t    --头部门名称\r\n        Headdepartment.cDepName AS HeadcDepName ,\r\n\t\t--头人员编码\r\n        NE_LoanVouch.LoanPersonID AS HeadPersonCode ,\r\n\t\t--头人员名称\r\n        HeadPerson.cpersonname AS HeadPersonName ,\r\n\t\t--行用途\r\n        NE_LoanVouch_Sub.Memo AS SubUsed\r\nFROM    NE_LoanVouch\r\n        INNER JOIN NE_LoanVouch_Sub ON NE_LoanVouch.ID = NE_LoanVouch_Sub.LoanVouchID\r\n        INNER JOIN NE_OperationType ON NE_LoanVouch.OperationTypeCode = NE_OperationType.Code\r\n        INNER JOIN foreigncurrency ON NE_LoanVouch.Currency = foreigncurrency.cexch_Name\r\n        LEFT JOIN bg_v_ctrlitem ON ne_loanvouch_sub.BudgetItemID = bg_v_ctrlitem.cItemCode\r\n        LEFT JOIN person ON NE_LoanVouch_Sub.BorrowerID = person.cpersoncode\r\n        LEFT JOIN department ON NE_LoanVouch_Sub.SpreadDeptID = department.cdepcode\r\n        LEFT JOIN department AS Headdepartment ON NE_LoanVouch.SpreadDeptID = Headdepartment.cdepcode\r\n        LEFT JOIN person AS HeadPerson ON NE_LoanVouch.LoanPersonID = HeadPerson.cpersoncode\r\n        LEFT JOIN fitem ON NE_LoanVouch_Sub.ItemClassID = fitem.citem_class\r\n        LEFT JOIN vwNEfitemss AS fitems ON fitem.citem_class = fitems.citem_class\r\n                                           AND NE_LoanVouch_Sub.ItemID = fitems.citemcode\r\nWHERE   ( OverBudget <> 1\r\n          OR BudgetState <> 1\r\n        )\r\n        AND ( ( ISNULL(OverBudget, -1) = 2 )\r\n              OR ( ISNULL(OverBudget, -1) = 3 )\r\n              OR ( ISNULL(OverBudget, -1) = 1 )\r\n            )  \r\n  \r\nUNION ALL    \r\n  \r\nSELECT  NE_OperationType.TypeID AS TypeID ,  \r\n        ISNULL(subVouch.CostItemID, '') AS CostItemID ,  \r\n        CONVERT(NVARCHAR(100), subVouch.ID) AS SubVouchID ,  \r\n        vouch.AuditorID ,  \r\n        CONVERT(NVARCHAR(100), vouch.ID) AS VouchID ,  \r\n        vouch.OperationTypeCode ,  \r\n        '0' AS flag ,  \r\n        foreigncurrency.bcal ,  \r\n        vouch.ExchangeRate ,  \r\n        NE_OperationType.Name AS OperationType ,  \r\n        vouch.Code AS VouchCode ,  \r\n        vouch.ExpenseDate AS VouchDate ,  \r\n        --头用途  \r\n        vouch.Used AS HeadUsed,  \r\n        subVouch.BudgetItemID ,  \r\n        subVouch.Port1 ,  \r\n        subVouch.Port1Value ,  \r\n        subVouch.Port2 ,  \r\n        subVouch.Port2Value ,  \r\n        subVouch.Port3 ,  \r\n        subVouch.Port3Value ,  \r\n        subVouch.Port4 ,  \r\n        subVouch.Port4Value ,  \r\n        subVouch.Port5 ,  \r\n        subVouch.Port5Value ,  \r\n        subVouch.Port6 ,  \r\n        subVouch.Port6Value ,  \r\n        bg_v_ctrlitem.cItemName AS BudgetItemName ,  \r\n        --行部门名称  \r\n        department.cDepName AS SubcDepName ,  \r\n  --行人员名称  \r\n        person.cpersonname AS SubPersonName ,    \r\n  --行人员编码  \r\n        subVouch.ExpenserID AS SubPersonCode ,  \r\n        --行部门编码  \r\n        department.cdepcode AS SubDeptID,  \r\n        subVouch.ItemClassID ,  \r\n        fitem.cItem_Name AS ItemClassName ,  \r\n        subVouch.ItemID ,  \r\n        fitems.cItemName AS ItemName ,  \r\n        --金额  \r\n        CASE WHEN ( bg_v_ctrlitem.cForeignCurrency <> vouch.Currency )  \r\n             THEN CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''  \r\n                       THEN vouch.LocalMoney  \r\n                       ELSE subVouch.LocalMoney  \r\n                  END  \r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1  \r\n                         THEN CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''  \r\n                                        THEN vouch.ExpenseMoney  \r\n                                        ELSE subVouch.ExpenseMoney  \r\n                                   END / vouch.ExchangeRate AS MONEY)  \r\n                         ELSE CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''  \r\n                                        THEN vouch.ExpenseMoney  \r\n                                        ELSE subVouch.ExpenseMoney  \r\n                                   END * vouch.ExchangeRate AS MONEY)  \r\n                    END )  \r\n        END dblMoney ,  \r\n        vouch.BudgetState ,  \r\n        vouch.OverBudget ,  \r\n        vouch.OverBudgetAuditor ,  \r\n        vouch.OverBudgetAuditDate ,  \r\n        vouch.OverBudgetAuditDesc,  \r\n        --无税金额  1收入报销单 无税取含税  \r\n        CASE WHEN typeid = 1 THEN   \r\n   CASE WHEN ( bg_v_ctrlitem.cForeignCurrency <> vouch.Currency )    \r\n             THEN CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''    \r\n                       THEN vouch.LocalMoney    \r\n                       ELSE subVouch.LocalMoney    \r\n                  END    \r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1    \r\n                         THEN CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''    \r\n                                        THEN vouch.ExpenseMoney    \r\n                                        ELSE subVouch.ExpenseMoney    \r\n                                   END / vouch.ExchangeRate AS MONEY)    \r\n                         ELSE CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''    \r\n                                        THEN vouch.ExpenseMoney    \r\n                                        ELSE subVouch.ExpenseMoney    \r\n                                   END * vouch.ExchangeRate AS MONEY)    \r\n                    END )    \r\n   END  \r\n  else  \r\n             CASE WHEN ( bg_v_ctrlitem.cForeignCurrency <> vouch.Currency )    \r\n             THEN CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''    \r\n                       THEN vouch.LocalNontaxAmount    \r\n                       ELSE subVouch.LocalNontaxAmountSub    \r\n                  END    \r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1    \r\n                         THEN CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''    \r\n                                        THEN vouch.NontaxAmount    \r\n                                        ELSE subVouch.NontaxAmountSub    \r\n                                   END / vouch.ExchangeRate AS MONEY)    \r\n                         ELSE CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''    \r\n                                        THEN vouch.NontaxAmount    \r\n                                        ELSE subVouch.NontaxAmountSub    \r\n                                   END * vouch.ExchangeRate AS MONEY)    \r\n                    END )    \r\n             END  \r\n        end NontaxAmount ,   \r\n        --头部门编码   \r\n        Headdepartment.cdepcode AS HeadDeptID ,   \r\n     --头部门名称  \r\n        Headdepartment.cDepName AS HeadcDepName ,  \r\n  --头人员编码  \r\n        vouch.ExpenserID AS HeadPersonCode ,  \r\n  --头人员名称  \r\n        HeadPerson.cpersonname AS HeadPersonName ,  \r\n  --行用途  \r\n        subVouch.Memo AS SubUsed  \r\nFROM    NE_Expenvouch AS vouch  \r\n        LEFT JOIN NE_ExpenseVouch_sub AS subVouch ON vouch.ID = subVouch.ExpenseVouchID  \r\n        LEFT JOIN NE_OperationType ON vouch.OperationTypeCode = NE_OperationType.Code  \r\n        LEFT JOIN foreigncurrency ON foreigncurrency.cexch_name = vouch.Currency  \r\n        LEFT JOIN bg_v_ctrlitem ON subVouch.BudgetItemID = bg_v_ctrlitem.cItemCode  \r\n        LEFT JOIN person ON subVouch.ExpenserID = person.cpersoncode  \r\n        LEFT JOIN department ON CASE WHEN ISNULL(subVouch.SpreadDeptID,'')='' THEN subVouch.deptid ELSE subVouch.SpreadDeptID end  = department.cdepcode  \r\n        LEFT JOIN department AS Headdepartment ON CASE WHEN ISNULL(vouch.SpreadDeptID,'')='' THEN vouch.deptid ELSE vouch.SpreadDeptID end = Headdepartment.cdepcode  \r\n        LEFT JOIN person AS HeadPerson ON vouch.ExpenserID = HeadPerson.cpersoncode  \r\n        LEFT JOIN fitem ON subVouch.ItemClassID = fitem.citem_class  \r\n        LEFT JOIN vwNEfitemss AS fitems ON fitem.citem_class = fitems.citem_class  \r\n                                           AND subVouch.ItemID = fitems.citemcode  \r\nWHERE   ( OverBudget <> 1  \r\n          OR BudgetState <> 1  \r\n        )  \r\n        AND ( ( ISNULL(OverBudget, -1) = 2 )  \r\n              OR ( ISNULL(OverBudget, -1) = 3 )  \r\n              OR ( ISNULL(OverBudget, -1) = 1 )  \r\n            )    \r\n      \r\nUNION ALL  \r\n  \r\nSELECT  NE_OperationType.TypeID AS TypeID ,\r\n        '' AS CostItemID ,\r\n        CONVERT(NVARCHAR(100), vouch.ID) AS SubVouchID ,\r\n        vouch.AuditorID ,\r\n        CONVERT(NVARCHAR(100), vouch.ID) AS VouchID ,\r\n        vouch.OperationTypeCode ,\r\n        '0' AS flag ,\r\n        foreigncurrency.bcal ,\r\n        vouch.ExchangeRate ,\r\n        NE_OperationType.Name AS OperationType ,\r\n        vouch.Code AS VouchCode ,\r\n        vouch.ReturnDate AS VouchDate ,\r\n        --头用途\r\n        vouch.Used AS HeadUsed,\r\n        vouch.BudgetItemID AS BudgetItemID ,\r\n        vouch.Port1 ,\r\n        vouch.Port1Value ,\r\n        vouch.Port2 ,\r\n        vouch.Port2Value ,\r\n        vouch.Port3 ,\r\n        vouch.Port3Value ,\r\n        vouch.Port4 ,\r\n        vouch.Port4Value ,\r\n        vouch.Port5 ,\r\n        vouch.Port5Value ,\r\n        vouch.Port6 ,\r\n        vouch.Port6Value ,\r\n        bg_v_ctrlitem.cItemName AS BudgetItemName ,\r\n        --cDepName ,\r\n        --person.cpersonname AS PersonName ,\r\n        --vouch.ReturnPersonID AS PersonCode ,\r\n        --vouch.DeptID ,        \r\n        --行部门名称 还款头等于行\r\n        cDepName AS SubcDepName ,\r\n\t\t--行人员名称 还款头等于行\r\n        person.cpersonname AS SubPersonName ,  \r\n\t\t--行人员编码 还款头等于行\r\n        vouch.ReturnPersonID AS SubPersonCode ,\r\n        --行部门编码 还款头等于行\r\n        vouch.DeptID AS SubDeptID,       \r\n        \r\n        vouch.ItemClassID ,\r\n        fitem.cItem_Name AS ItemClassName ,\r\n        vouch.ItemID ,\r\n        fitems.cItemName AS ItemName ,\r\n        CASE WHEN ( bg_v_ctrlitem.cForeignCurrency <> vouch.Currency )\r\n             THEN CASE WHEN ISNULL(vouch.BudgetItemID, '') = ''\r\n                       THEN vouch.LocalMoney\r\n                       ELSE Vouch.LocalMoney\r\n                  END\r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1\r\n                         THEN CAST(CASE WHEN ISNULL(Vouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.ReturnMoney\r\n                                        ELSE Vouch.ReturnMoney\r\n                                   END / vouch.ExchangeRate AS MONEY)\r\n                         ELSE CAST(CASE WHEN ISNULL(Vouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.ReturnMoney\r\n                                        ELSE Vouch.ReturnMoney\r\n                                   END * vouch.ExchangeRate AS MONEY)\r\n                    END )\r\n        END dblMoney ,\r\n        vouch.BudgetState ,\r\n        vouch.OverBudget ,\r\n        vouch.OverBudgetAuditor ,\r\n        vouch.OverBudgetAuditDate ,\r\n        vouch.OverBudgetAuditDesc,\r\n        --还款无税默认等于含税\r\n        CASE WHEN ( bg_v_ctrlitem.cForeignCurrency <> vouch.Currency )\r\n             THEN CASE WHEN ISNULL(vouch.BudgetItemID, '') = ''\r\n                       THEN vouch.LocalMoney\r\n                       ELSE Vouch.LocalMoney\r\n                  END\r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1\r\n                         THEN CAST(CASE WHEN ISNULL(Vouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.ReturnMoney\r\n                                        ELSE Vouch.ReturnMoney\r\n                                   END / vouch.ExchangeRate AS MONEY)\r\n                         ELSE CAST(CASE WHEN ISNULL(Vouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.ReturnMoney\r\n                                        ELSE Vouch.ReturnMoney\r\n                                   END * vouch.ExchangeRate AS MONEY)\r\n                    END )\r\n        END NontaxAmount ,\r\n        \r\n        --头部门编码 \r\n        vouch.DeptID AS HeadDeptID , \r\n\t    --头部门名称\r\n        department.cDepName AS HeadcDepName ,\r\n\t\t--头人员编码\r\n        vouch.ReturnPersonID AS HeadPersonCode ,\r\n\t\t--头人员名称\r\n        Person.cpersonname AS HeadPersonName ,\r\n\t\t--行用途\r\n        vouch.Used AS SubUsed\r\nFROM    NE_ReturnVouch AS vouch\r\n        INNER JOIN NE_OperationType ON vouch.OperationTypeCode = NE_OperationType.Code\r\n        INNER JOIN foreigncurrency ON foreigncurrency.cexch_name = vouch.Currency\r\n        LEFT JOIN bg_v_ctrlitem ON vouch.BudgetItemID = bg_v_ctrlitem.cItemCode\r\n        LEFT JOIN person ON vouch.ReturnPersonID = person.cpersoncode\r\n        LEFT JOIN department ON vouch.DeptID = department.cdepcode\r\n        LEFT JOIN fitem ON vouch.ItemClassID = fitem.citem_class\r\n        LEFT JOIN vwNEfitemss AS fitems ON fitem.citem_class = fitems.citem_class\r\n                                           AND vouch.ItemID = fitems.citemcode\r\nWHERE   ( OverBudget <> 1\r\n          OR BudgetState <> 1\r\n        )\r\n        AND ( ( ISNULL(OverBudget, -1) = 2 )\r\n              OR ( ISNULL(OverBudget, -1) = 3 )\r\n              OR ( ISNULL(OverBudget, -1) = 1 )\r\n            )  \r\n  \r\nUNION ALL  \r\n  \r\nSELECT  NE_OperationType.TypeID AS TypeID ,\r\n        '' AS CostItemID ,\r\n        CONVERT(NVARCHAR(100), subVouch.ID) AS SubVouchID ,\r\n        vouch.AuditorID ,\r\n        CONVERT(NVARCHAR(100), vouch.ID) AS VouchID ,\r\n        vouch.OperationTypeCode ,\r\n        '0' AS flag ,\r\n        foreigncurrency.bcal ,\r\n        vouch.ExchangeRate ,\r\n        NE_OperationType.Name AS OperationType ,\r\n        vouch.Code AS VouchCode ,\r\n        CASE WHEN ISNULL(vouch.BudgetDate, '') = '' THEN vouch.ApplyDate\r\n             ELSE vouch.BudgetDate\r\n        END AS VouchDate ,\r\n        --头用途\r\n        vouch.Used AS HeadUsed,\r\n        subVouch.BudgetItemID ,\r\n        subVouch.Port1 ,\r\n        subVouch.Port1Value ,\r\n        subVouch.Port2 ,\r\n        subVouch.Port2Value ,\r\n        subVouch.Port3 ,\r\n        subVouch.Port3Value ,\r\n        subVouch.Port4 ,\r\n        subVouch.Port4Value ,\r\n        subVouch.Port5 ,\r\n        subVouch.Port5Value ,\r\n        subVouch.Port6 ,\r\n        subVouch.Port6Value ,\r\n        bg_v_ctrlitem.cItemName AS BudgetItemName ,        \r\n        --行部门名称\r\n        department.cDepName AS SubcDepName ,\r\n\t\t--行人员名称\r\n        person.cpersonname AS SubPersonName ,  \r\n\t\t--行人员编码\r\n        subVouch.ApplicantID AS SubPersonCode ,\r\n        --行部门编码\r\n        subVouch.ApplyDeptID AS SubDeptID,\r\n        vouch.ItemClassID ,\r\n        fitem.cItem_Name AS ItemClassName ,\r\n        vouch.ItemID ,\r\n        fitems.cItemName AS ItemName ,\r\n        CASE WHEN ( bg_v_ctrlitem.cForeignCurrency <> vouch.Currency )\r\n             THEN CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''\r\n                       THEN vouch.LocalMoney\r\n                       ELSE subVouch.LocalMoney\r\n                  END\r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1\r\n                         THEN CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.ApplyMoney\r\n                                        ELSE subVouch.ApplyMoney\r\n                                   END / vouch.ExchangeRate AS MONEY)\r\n                         ELSE CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.ApplyMoney\r\n                                        ELSE subVouch.ApplyMoney\r\n                                   END * vouch.ExchangeRate AS MONEY)\r\n                    END )\r\n        END dblMoney ,\r\n        vouch.BudgetState ,\r\n        vouch.OverBudget ,\r\n        vouch.OverBudgetAuditor ,\r\n        vouch.OverBudgetAuditDate ,\r\n        vouch.OverBudgetAuditDesc,\r\n        CASE WHEN ( bg_v_ctrlitem.cForeignCurrency <> vouch.Currency )\r\n             THEN CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''\r\n                       THEN vouch.NontaxAmount\r\n                       ELSE subVouch.NontaxAmountSub\r\n                  END\r\n             ELSE ( CASE WHEN foreigncurrency.bcal = 1\r\n                         THEN CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.NontaxAmount\r\n                                        ELSE subVouch.NontaxAmountSub\r\n                                   END / vouch.ExchangeRate AS MONEY)\r\n                         ELSE CAST(CASE WHEN ISNULL(subVouch.BudgetItemID, '') = ''\r\n                                        THEN vouch.NontaxAmount\r\n                                        ELSE subVouch.NontaxAmountSub\r\n                                   END * vouch.ExchangeRate AS MONEY)\r\n                    END )\r\n        END NontaxAmount ,\r\n        --头部门编码 \r\n        vouch.SpreadDeptID AS HeadDeptID , \r\n\t    --头部门名称\r\n        Headdepartment.cDepName AS HeadcDepName ,\r\n\t\t--头人员编码\r\n        vouch.ApplicantID AS HeadPersonCode ,\r\n\t\t--头人员名称\r\n        HeadPerson.cpersonname AS HeadPersonName ,\r\n\t\t--行用途\r\n        subVouch.Used AS SubUsed\r\nFROM    NE_CostApply AS vouch\r\n        LEFT JOIN NE_CostApply_Sub AS subVouch ON vouch.ID = subVouch.CostApplyID\r\n        LEFT JOIN NE_OperationType ON vouch.OperationTypeCode = NE_OperationType.Code\r\n        LEFT JOIN foreigncurrency ON foreigncurrency.cexch_name = vouch.Currency\r\n        LEFT JOIN bg_v_ctrlitem ON vouch.BudgetItemID = bg_v_ctrlitem.cItemCode\r\n        LEFT JOIN person ON subVouch.ApplicantID = person.cpersoncode\r\n        LEFT JOIN department ON subVouch.SpreadDeptID = department.cdepcode\r\n        LEFT JOIN department AS Headdepartment ON vouch.SpreadDeptID = Headdepartment.cdepcode\r\n        LEFT JOIN person AS HeadPerson ON vouch.ApplicantID = HeadPerson.cpersoncode\r\n        LEFT JOIN fitem ON vouch.ItemClassID = fitem.citem_class\r\n        LEFT JOIN vwNEfitemss AS fitems ON fitem.citem_class = fitems.citem_class\r\n                                           AND vouch.ItemID = fitems.citemcode\r\nWHERE   ( OverBudget <> 1\r\n          OR BudgetState <> 1\r\n        )\r\n        AND ( ( ISNULL(OverBudget, -1) = 2 )\r\n              OR ( ISNULL(OverBudget, -1) = 3 )\r\n              OR ( ISNULL(OverBudget, -1) = 1 )\r\n            )","summary":[{"field":"Documentation","value":{"_type":"link","name":"U8V16.5数据字典","id":"d6"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"NE_VouchOverBudgetInfo_View"},{"field":"Type","value":"View"}],"columns":[{"id":"column-251190","object_id":"column-251190","name":"TypeID","name_without_path":"TypeID","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251191","object_id":"column-251191","name":"CostItemID","name_without_path":"CostItemID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"60","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251192","object_id":"column-251192","name":"SubVouchID","name_without_path":"SubVouchID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"100","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251193","object_id":"column-251193","name":"AuditorID","name_without_path":"AuditorID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251194","object_id":"column-251194","name":"VouchID","name_without_path":"VouchID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"100","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251195","object_id":"column-251195","name":"OperationTypeCode","name_without_path":"OperationTypeCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251196","object_id":"column-251196","name":"flag","name_without_path":"flag","description":null,"is_pk":false,"is_identity":false,"data_type":"varchar","data_length":"1","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251197","object_id":"column-251197","name":"bcal","name_without_path":"bcal","description":null,"is_pk":false,"is_identity":false,"data_type":"bit","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251198","object_id":"column-251198","name":"ExchangeRate","name_without_path":"ExchangeRate","description":null,"is_pk":false,"is_identity":false,"data_type":"float","data_length":null,"is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251199","object_id":"column-251199","name":"OperationType","name_without_path":"OperationType","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"255","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251200","object_id":"column-251200","name":"VouchCode","name_without_path":"VouchCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251201","object_id":"column-251201","name":"VouchDate","name_without_path":"VouchDate","description":null,"is_pk":false,"is_identity":false,"data_type":"datetime","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251202","object_id":"column-251202","name":"HeadUsed","name_without_path":"HeadUsed","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1024","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251203","object_id":"column-251203","name":"BudgetItemID","name_without_path":"BudgetItemID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251204","object_id":"column-251204","name":"Port1","name_without_path":"Port1","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251205","object_id":"column-251205","name":"Port1Value","name_without_path":"Port1Value","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251206","object_id":"column-251206","name":"Port2","name_without_path":"Port2","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251207","object_id":"column-251207","name":"Port2Value","name_without_path":"Port2Value","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251208","object_id":"column-251208","name":"Port3","name_without_path":"Port3","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251209","object_id":"column-251209","name":"Port3Value","name_without_path":"Port3Value","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251210","object_id":"column-251210","name":"Port4","name_without_path":"Port4","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251211","object_id":"column-251211","name":"Port4Value","name_without_path":"Port4Value","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251212","object_id":"column-251212","name":"Port5","name_without_path":"Port5","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251213","object_id":"column-251213","name":"Port5Value","name_without_path":"Port5Value","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251214","object_id":"column-251214","name":"Port6","name_without_path":"Port6","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251215","object_id":"column-251215","name":"Port6Value","name_without_path":"Port6Value","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1000","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251216","object_id":"column-251216","name":"BudgetItemName","name_without_path":"BudgetItemName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"120","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251217","object_id":"column-251217","name":"SubcDepName","name_without_path":"SubcDepName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"255","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251218","object_id":"column-251218","name":"SubPersonName","name_without_path":"SubPersonName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"40","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251219","object_id":"column-251219","name":"SubPersonCode","name_without_path":"SubPersonCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251220","object_id":"column-251220","name":"SubDeptID","name_without_path":"SubDeptID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251221","object_id":"column-251221","name":"ItemClassID","name_without_path":"ItemClassID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251222","object_id":"column-251222","name":"ItemClassName","name_without_path":"ItemClassName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251223","object_id":"column-251223","name":"ItemID","name_without_path":"ItemID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"60","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251224","object_id":"column-251224","name":"ItemName","name_without_path":"ItemName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"255","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251225","object_id":"column-251225","name":"dblMoney","name_without_path":"dblMoney","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"19, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251226","object_id":"column-251226","name":"BudgetState","name_without_path":"BudgetState","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251227","object_id":"column-251227","name":"OverBudget","name_without_path":"OverBudget","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251228","object_id":"column-251228","name":"OverBudgetAuditor","name_without_path":"OverBudgetAuditor","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251229","object_id":"column-251229","name":"OverBudgetAuditDate","name_without_path":"OverBudgetAuditDate","description":null,"is_pk":false,"is_identity":false,"data_type":"datetime","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251230","object_id":"column-251230","name":"OverBudgetAuditDesc","name_without_path":"OverBudgetAuditDesc","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"120","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251231","object_id":"column-251231","name":"NontaxAmount","name_without_path":"NontaxAmount","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"19, 4","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251232","object_id":"column-251232","name":"HeadDeptID","name_without_path":"HeadDeptID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251233","object_id":"column-251233","name":"HeadcDepName","name_without_path":"HeadcDepName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"255","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251234","object_id":"column-251234","name":"HeadPersonCode","name_without_path":"HeadPersonCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251235","object_id":"column-251235","name":"HeadPersonName","name_without_path":"HeadPersonName","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"40","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-251236","object_id":"column-251236","name":"SubUsed","name_without_path":"SubUsed","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"1024","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]}],"relations":[],"triggers":[],"unique_keys":[],"dependencies":null,"imported_at":"2024-07-15 13:47"};