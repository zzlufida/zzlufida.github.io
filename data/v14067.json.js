window.repositoryObject = {"columns_custom_fields":[],"relations_custom_fields":[],"triggers_custom_fields":[],"object_id":"v14067","name":"V_VM_ExportToWeChat_FeeDetail","subtype":"VIEW","is_user_defined":false,"description":null,"script":"create view V_VM_ExportToWeChat_FeeDetail\r\nAS\r\nselect   \r\nm.cwechat AS cOpenID,\r\nm.wechatmemberid AS iMemberID,--\tint\t会员ID\t\r\n--cOpenID,--\tvarchar(40)\t粉丝\t冗余\r\n--iPointChangeType,--\tint\t积分变化方式\t增项：1 领卡送积分2 签到送积分3 连续签到送积分4 完善信息送积分5 商城送积分6 实体店消费送积分减项：51商城抵现52兑换优惠券53抽奖机会\r\nd.fmemberfee AS iChangePoint,--\tint\t积分变化\t正数为增加积分；负数为减少积分。\r\nCONVERT(varchar(19),(case d.dcreatesystime when null then null else (case when d.dcreatesystime < '1970-01-01 08:00:00' then '1970-01-01 08:00:00' else (case when d.dcreatesystime > '2038-01-01' then '2038-01-01 00:00:00' else d.dcreatesystime end) end) end),121)  AS dPointChangeTime,--\tint\t获得积分时间\t\r\nCONVERT(varchar(19),(case d.dcalculatedate when null then null else (case when d.dcalculatedate < '1970-01-01 08:00:00' then '1970-01-01 08:00:00' else (case when d.dcalculatedate > '2038-01-01' then '2038-01-01 00:00:00' else d.dcalculatedate end) end) end),121)  AS dCalculateDate\t,--int\t积分计算时间\t\r\nCONVERT(varchar(10),(case d.dfeeeffectiveperiodto when null then null else (case when d.dfeeeffectiveperiodto < '1970-01-01 08:00:00' then '1970-01-01 08:00:00' else (case when d.dfeeeffectiveperiodto > '2038-01-01' then '2038-01-01 00:00:00' else d.dfeeeffectiveperiodto end) end) end),121)  AS dEffectivePeriod,--\tint\t积分有效期至\t\r\nd.csourcecode AS cSourceCode,--\tVarchar(60)\t来源单据号\t\t\r\nd.ctradecode AS cTradeCode,--\tVarchar(60)\t交易编码\t存电商相关的id，商城订单id及其他平台电商的交易号\r\nd.fmoney AS fSum,--\tDecimal(12,2)\t金额\t\r\nm.cmobilephone as cPhone,--\tvarchar(20)\t电话\r\nd.oid AS cOutSysKey,\r\nd.omemberid,\r\nCONVERT(char,convert(money,d.ufts),2) as ufts  ,\r\n(CASE cfeesource WHEN 1 THEN 101 WHEN 2 THEN 102 WHEN 3 THEN 103 WHEN 5 THEN 104 WHEN 6 THEN 105 WHEN 7 THEN 106 else cfeesource END) AS cfeesource,\r\n(CASE WHEN cfeesource =2 OR cfeesource =3 OR cfeesource =5 or cfeesource =6 THEN '来源类型：'+e.EnumName+' 来源单据号:'+d.csourcecode+' 积分:'+cast(d.fmemberfee AS NVARCHAR( 100))  ELSE '来源类型：'+e.EnumName +' 积分:'+cast(d.fmemberfee AS NVARCHAR( 100)) END ) AS cMemo,\r\n\r\n(case cfeesource when 5 then 2 else 1 end)  as iSourceType\r\n \r\n\r\n\r\n--vm.feedetailsource\t1\tzh-cn\t期初\r\n--vm.feedetailsource\t2\tzh-cn\t电商订单\r\n--vm.feedetailsource\t3\tzh-cn\t电商退款\r\n--vm.feedetailsource\t4\tzh-cn\t易联\r\n--vm.feedetailsource\t5\tzh-cn\t零售\r\n--vm.feedetailsource\t6\tzh-cn\t积分调整\r\n--vm.feedetailsource\t7\tzh-cn\t会员晋级\r\n--vm.feedetailsource\t8\tzh-cn\t推荐返利\r\n\r\n\r\nFROM VM_FeeDetail d\r\nINNER JOIN VM_Member m ON d.omemberid =m.oid  \r\nLEFT JOIN v_aa_enum e ON d.cfeesource  =e.EnumCode  AND e.EnumType ='vm.feedetailsource'\r\n--WHERE ISNULL(m.cwechat,'')<>'' AND ISNULL(m.wechatmemberid,-1)<>-1 AND cfeesource <>4\r\nWHERE  ISNULL(m.cmobilephone,'')<>'' AND cfeesource <>4 --12.5修改，易联修改为会员中心，cwechat可以为空\r\n\r\n AND\r\n DATEDIFF(YEAR,ISNULL(m.dlastbuydate,m.ddate), getdate())<=(SELECT  TOP 1 ISNULL(cValue ,cDefault ) FROM AccInformation WHERE cSysID ='VM' AND  cName ='VMToWeChat_EffectiveYears')","summary":[{"field":"Documentation","value":{"_type":"link","name":"U8V16.5数据字典","id":"d6"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"V_VM_ExportToWeChat_FeeDetail"},{"field":"Type","value":"View"}],"columns":[{"id":"column-413688","object_id":"column-413688","name":"cOpenID","name_without_path":"cOpenID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"50","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413689","object_id":"column-413689","name":"iMemberID","name_without_path":"iMemberID","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413690","object_id":"column-413690","name":"iChangePoint","name_without_path":"iChangePoint","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"28, 2","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413691","object_id":"column-413691","name":"dPointChangeTime","name_without_path":"dPointChangeTime","description":null,"is_pk":false,"is_identity":false,"data_type":"varchar","data_length":"19","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413692","object_id":"column-413692","name":"dCalculateDate","name_without_path":"dCalculateDate","description":null,"is_pk":false,"is_identity":false,"data_type":"varchar","data_length":"19","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413693","object_id":"column-413693","name":"dEffectivePeriod","name_without_path":"dEffectivePeriod","description":null,"is_pk":false,"is_identity":false,"data_type":"varchar","data_length":"10","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413694","object_id":"column-413694","name":"cSourceCode","name_without_path":"cSourceCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"60","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413695","object_id":"column-413695","name":"cTradeCode","name_without_path":"cTradeCode","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"60","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413696","object_id":"column-413696","name":"fSum","name_without_path":"fSum","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"28, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413697","object_id":"column-413697","name":"cPhone","name_without_path":"cPhone","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"100","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413698","object_id":"column-413698","name":"cOutSysKey","name_without_path":"cOutSysKey","description":null,"is_pk":false,"is_identity":false,"data_type":"bigint","data_length":null,"is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413699","object_id":"column-413699","name":"omemberid","name_without_path":"omemberid","description":null,"is_pk":false,"is_identity":false,"data_type":"bigint","data_length":null,"is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413700","object_id":"column-413700","name":"ufts","name_without_path":"ufts","description":null,"is_pk":false,"is_identity":false,"data_type":"char","data_length":"30","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413701","object_id":"column-413701","name":"cfeesource","name_without_path":"cfeesource","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413702","object_id":"column-413702","name":"cMemo","name_without_path":"cMemo","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"338","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-413703","object_id":"column-413703","name":"iSourceType","name_without_path":"iSourceType","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]}],"relations":[],"triggers":[],"unique_keys":[],"dependencies":null,"imported_at":"2024-07-15 13:47"};