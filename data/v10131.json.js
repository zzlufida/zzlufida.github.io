window.repositoryObject = {"columns_custom_fields":[],"relations_custom_fields":[],"triggers_custom_fields":[],"object_id":"v10131","name":"CAQ_PlanD","subtype":"VIEW","is_user_defined":false,"description":null,"script":"Create VIEW CAQ_PlanD\r\nAS\r\n-- 子件是半成品的情况，存货编码一样的求和\r\nselect cVerID,Cppid,convert(nvarchar(255),iPartID) as cAmoID,0 as cAmoType,sum(iQua) as iQua,sum(iPdtUnitAMo * iQua ) as iPdtunitAmo,0 as iPartHourQua,0 as iPartHourAmo\r\nFROM\r\n(\r\nselect ca_awpc.cVerID,ca_awpc.cPPID,ca_awpc.cAmoID,ca_awpc.cAmoType,ca_awpc.iQua,caq_coplan.iPartID,sum(iPdtUnitAMo) AS iPdtUnitAMo\r\nfrom ca_awpc\r\ninner join ca_coplan on ca_coplan.iPlanCOID  =ca_awpc.cppid\r\ninner join caq_baspart on caq_baspart.partid=ca_coplan.ipartid\r\ninner join v_bas_inventory V on V.InvCode=caq_baspart.invcode\r\nleft join caq_coplan on ca_awpc.cAmoID=caq_coplan.iPlanCOID\r\nleft join ca_planc on ca_awpc.cAmoID=ca_planc.cPPID and ca_awpc.cVerID=ca_planc.cVerID\r\nwhere ca_awpc.cAmoType=5 and ca_awpc.iQua<>0  and v.InvAttr<>'2'\r\ngroup by ca_awpc.cVerID,ca_awpc.cPPID,caq_coplan.iPartID,ca_awpc.cAmoID,ca_awpc.cAmoType,ca_awpc.iQua\r\n\r\n) A\r\nGROUP BY cVerID,Cppid,iPartID,cAmoType\r\n\r\nunion all\r\n\r\n--子件是材料,材料×单价=材料金额\r\nselect ca_awpc.cVerID,cPPID,ca_awpc.cAmoID,cAmoType,iQua,iQua*iInvRCost as iPdtUnitAmo,0 as iPartHourQua,0 as iPartHourAmo\r\nfrom ca_awpc inner join ca_invprice on ca_awpc.cAmoID =ca_invprice.ipartid and ca_awpc.cVerID=ca_invprice.cVerID\r\nwhere ca_awpc.cAmoType=0\r\n\r\nunion all\r\n\r\n--begin 人工费用\r\nselect A.cVerID,A.cppID,A.cAmoID,A.cAmoType,A.iQua,\r\n (case isnull(E.iDirMethod,1) when 1 then isnull(C.iPlanMauAmoRat,0)\r\n       when 2 then  isnull(C.iPlanMauAmoRat,0)\r\n       when 3 then  isnull(D.iPlanMauAmoRat,0)\r\n       else 0 end) * A.iQua as iPdtUnitAmo,A.iPartHourQua as iPartHourQua,\r\n (case isnull(E.iDirMethod,1) when 1 then isnull(C.iPlanMauAmoRat,0)\r\n       when 2 then  isnull(C.iPlanMauAmoRat,0)\r\n       when 3 then  isnull(D.iPlanMauAmoRat,0)\r\n       else 0 end) * A.iPartHourQua  as iPartHourAmo\r\nFrom ca_awpc A\r\nleft join Ca_PerCostMode E on A.cVerID=E.cVerID\r\ninner join ca_coplan B on A.cppid = B.iplancoid\r\ninner join caq_baspart on caq_baspart.partid=B.ipartid\r\ninner join v_bas_inventory V on V.InvCode=caq_baspart.invcode\r\nleft join CA_DepPMA C on B.cdeptid = C.cdeptid and A.cVerID=C.cVerID and A.cAmoType=C.cAmoType\r\nleft join CA_ProPMA D on A.camoid = D.cProcedureID and A.cVerID=D.cVerID\r\n where  A.cAmoType=1   and  v.InvAttr<>'2'\r\n\r\nunion all\r\n--begin 辅助费用\r\nselect ca_awpc.cVerID,cPPID,cAmoID,cAmoType,iQua,iQua*iPlanPrice as iPdtUnitAmo,0 as iPartHourQua,0 as iPartHourAmo\r\nfrom ca_awpc\r\ninner join ca_coplan B on ca_awpc.cppid = B.iplancoid\r\ninner join caq_baspart on caq_baspart.partid=B.ipartid\r\ninner join v_bas_inventory V on V.InvCode=caq_baspart.invcode\r\nleft join ca_assmp on ca_awpc.cAmoID=ca_assmp.cAuxAmoID and ca_awpc.cVerID=ca_assmp.cVerID\r\nwhere cAmoType=2  and  v.InvAttr<>'2'\r\n\r\nunion all\r\n--制造费用\r\nselect A.cVerID,A.cppID,A.cAmoID,A.cAmoType,A.iQua,\r\n isnull(C.iPlanMauAmoRat,0) * A.iQua as iPdtUnitAmo,A.iPartHourQua as iPartHourQua,isnull(C.iPlanMauAmoRat,0) * A.iPartHourQua as iPdtUnitAmo\r\nFrom ca_awpc A\r\ninner join ca_coplan B on A.cppid = B.iplancoid\r\ninner join caq_baspart on caq_baspart.partid=B.ipartid\r\ninner join v_bas_inventory V on V.InvCode=caq_baspart.invcode\r\nleft join CA_DepPMA C on B.cdeptid = C.cdeptid and A.cVerID=C.cVerID and A.cAmoType=C.cAmoType and A.cAmoID=C.cAmoID\r\n where  A.cAmoType=3   and  v.InvAttr<>'2'\r\n\r\nunion all\r\n--begin 其他费用\r\nselect cVerID,cPPID,cAmoID,cAmoType,iQua,iAmo as iPdtUnitAmo,0 as iPartHourQua,0 as iPartHourAmo\r\nfrom ca_awpc  A\r\ninner join ca_coplan B on A.cppid = B.iplancoid\r\ninner join caq_baspart on caq_baspart.partid=B.ipartid\r\ninner join v_bas_inventory V on V.InvCode=caq_baspart.invcode\r\nwhere cAmoType = 4  and  v.InvAttr<>'2'\r\nunion all\r\n--委外加工费\r\nselect cVerID,cPPID,'-1' as cAmoID,'4' as cAmoType,iQua,iAmo as iPdtUnitAmo,0 as iPartHourQua,0 as iPartHourAmo\r\nfrom ca_awpc  A\r\ninner join ca_coplan B on A.cppid = B.iplancoid\r\ninner join caq_baspart on caq_baspart.partid=B.ipartid\r\ninner join v_bas_inventory V on V.InvCode=caq_baspart.invcode\r\nwhere cAmoType = 6  and  v.InvAttr='2'","summary":[{"field":"Documentation","value":{"_type":"link","name":"U8V16.5数据字典","id":"d6"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"CAQ_PlanD"},{"field":"Type","value":"View"}],"columns":[{"id":"column-174309","object_id":"column-174309","name":"cVerID","name_without_path":"cVerID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"40","is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-174310","object_id":"column-174310","name":"Cppid","name_without_path":"Cppid","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-174311","object_id":"column-174311","name":"cAmoID","name_without_path":"cAmoID","description":null,"is_pk":false,"is_identity":false,"data_type":"nvarchar","data_length":"255","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-174312","object_id":"column-174312","name":"cAmoType","name_without_path":"cAmoType","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-174313","object_id":"column-174313","name":"iQua","name_without_path":"iQua","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 12","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-174314","object_id":"column-174314","name":"iPdtunitAmo","name_without_path":"iPdtunitAmo","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-174315","object_id":"column-174315","name":"iPartHourQua","name_without_path":"iPartHourQua","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 12","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-174316","object_id":"column-174316","name":"iPartHourAmo","name_without_path":"iPartHourAmo","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"38, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]}],"relations":[],"triggers":[],"unique_keys":[],"dependencies":null,"imported_at":"2024-07-15 13:47"};