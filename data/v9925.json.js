window.repositoryObject = {"columns_custom_fields":[],"relations_custom_fields":[],"triggers_custom_fields":[],"object_id":"v9925","name":"AP_V_IMOrderApply","subtype":"VIEW","is_user_defined":false,"description":null,"script":"CREATE VIEW [dbo].[AP_V_IMOrderApply] \r\nAS\r\n\r\nSELECT autoid as POsID,\r\n  fmoney,fcreditmoney,(ISNULL(fcreditmoney,0)+ISNULL(iOrderAmt_f,0)) as iOrderAmt_f,iCmPreAmt_f,iBillAmt_f, \r\n  (ISNULL(fcreditmoney,0)+ISNULL(iOrderAmt_f,0)) as Y_iOrderAmt_f,iBillAmt_f as Y_iBillAmt_f,\r\n  (ISNULL(fcreditmoney,0)+ISNULL(iOrderAmt_f,0)+ISNULL(iBillAmt_f,0)) as iTotalAmt_f,\r\n  (fmoney-ISNULL(fcreditmoney,0)-ISNULL(iOrderAmt_f,0)-ISNULL(iBillAmt_f,0)) as iApplySum_f,  \r\n  fnatmoney,fnatcreditmoney,(ISNULL(fnatcreditmoney,0)+ISNULL(iOrderAmt,0)) as iOrderAmt,iCmPreAmt,iBillAmt, \r\n  (ISNULL(fnatcreditmoney,0)+ISNULL(iOrderAmt,0)) as Y_iOrderAmt,iBillAmt as Y_iBillAmt,\r\n  (ISNULL(fnatcreditmoney,0)+ISNULL(iOrderAmt,0)+ISNULL(iBillAmt,0)) as iTotalAmt,\r\n  (fnatmoney-ISNULL(fnatcreditmoney,0)-ISNULL(iOrderAmt,0)-ISNULL(iBillAmt,0)) as iApplySum  \r\nFROM IM_Order PO  \r\n  INNER JOIN IM_OrderDetail POs ON PO.id = POs.id  \r\n\r\n  LEFT JOIN (  \r\n    select iBVid,sum(case when Apps.cLineCloser is null then iSrcApplyAmt_f else iSrcPayAmt_f end) as iOrderAmt_f,  \r\n      sum(case when Apps.cLineCloser is null then iSrcApplyAmt else iSrcPayAmt end) as iOrderAmt\r\n    from AP_ApplyPayVouch inner join AP_ApplyPayVouchs Apps ON AP_ApplyPayVouch.PID = Apps.PID\r\n\tLEFT JOIN (  \r\n\t  select PID,PIDs,sum(iSrcPayAmt_f) as iSrcPayAmt_f,sum(iSrcPayAmt) as iSrcPayAmt\r\n\t  from AP_PayDetail Group by PID,PIDs  \r\n\t) AS Pay ON Apps.AutoID=Pay.PIDs  \r\n\twhere Apps.cSource=N'进口订单' \r\n\t\t-- 10.1sp1代理专项 排除代理订单申请的费用类申请 add AP_ApplyPayVouch 表关联\r\n\t\tand (AP_ApplyPayVouch.iBusType is null or (isnull(AP_ApplyPayVouch.iBusType,-1) = 0 and isnull(AP_ApplyPayVouch.iPayType,-1) = 0)) \r\n\tGROUP BY iBVid\r\n  ) AS App ON POs.autoid=App.iBVid  \r\n\r\n  LEFT JOIN (  \r\n    SELECT BalancesGuid,sum(iSrcApplyAmt_f) as iCmPreAmt_f,sum(iSrcApplyAmt) as iCmPreAmt   \r\n    FROM AP_V_ApplyPayCal WHERE cSource=N'合同' GROUP BY BalancesGuid  \r\n  ) AS AppCM ON POs.ccontractrowguid=AppCM.BalancesGuid  \r\n\r\n  --发票已申请金额，订单开票后允许继续申请\r\n  LEFT JOIN (  \r\n   SELECT PBs.iorderautoid,sum(ISNULL(iBillAmt_f,0))+SUM(ISNULL(iXJAmount_f,0)) as iBillAmt_f,sum(ISNULL(iBillAmt,0)) +SUM(ISNULL(iXJAmount,0)) as iBillAmt  \r\n    FROM  IM_InvoiceDetail PBs  left JOIN \r\n    (  \r\n      select iBVid,sum(case when Apps.cLineCloser is null then iSrcApplyAmt_f else iSrcPayAmt_f end) as iBillAmt_f,  \r\n        sum(case when Apps.cLineCloser is null then iSrcApplyAmt else iSrcPayAmt end) as iBillAmt\r\n      from AP_ApplyPayVouchs Apps \r\n\t  LEFT JOIN (  \r\n\t    select PID,PIDs,sum(iSrcPayAmt_f) as iSrcPayAmt_f,sum(iSrcPayAmt) as iSrcPayAmt\r\n\t    from AP_PayDetail Group by PID,PIDs  \r\n\t  ) AS Pay ON Apps.AutoID=Pay.PIDs  \r\n\t  where cSource=N'进口发票' GROUP BY iBVid\r\n    ) AS PUBill   ON PBs.autoid=PUBill.iBVid \r\n     left join (\r\n\t\tSELECT ibvid,sum(iAmount) as iXJAmount,sum(iAmount_f) as iXJAmount_f FROM Ap_XjDetail with(nolock) where cCoVouchType like 'IM%'\r\n\t\tgroup by ibvid) Xj ON PBs.autoid=Xj.iBVid\t\r\n\tINNER JOIN IM_Invoice PBh ON PBs.id =PBh.id where cvouchtype in (N'im91',N'im90')   -- 10.1sp1代理专项 仅处理商务发票,排除掉费用发票\r\n\r\n    GROUP BY PBs.iorderautoid\r\n\r\n  ) AS AppPU ON POs.autoid=AppPU.iorderautoid\r\nWHERE ISNULL(iCmPreAmt_f,0)=0 \r\n  and ISNULL(cVerifier,'')<>'' And ISNULL(cCloser,'')=''","summary":[{"field":"Documentation","value":{"_type":"link","name":"U8V16.5数据字典","id":"d6"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"AP_V_IMOrderApply"},{"field":"Type","value":"View"}],"columns":[{"id":"column-164872","object_id":"column-164872","name":"POsID","name_without_path":"POsID","description":null,"is_pk":false,"is_identity":false,"data_type":"int","data_length":null,"is_nullable":false,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164873","object_id":"column-164873","name":"fmoney","name_without_path":"fmoney","description":null,"is_pk":false,"is_identity":false,"data_type":"exmoney: decimal","data_length":"18, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164874","object_id":"column-164874","name":"fcreditmoney","name_without_path":"fcreditmoney","description":null,"is_pk":false,"is_identity":false,"data_type":"exmoney: decimal","data_length":"18, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164875","object_id":"column-164875","name":"iOrderAmt_f","name_without_path":"iOrderAmt_f","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"22, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164876","object_id":"column-164876","name":"iCmPreAmt_f","name_without_path":"iCmPreAmt_f","description":null,"is_pk":false,"is_identity":false,"data_type":"money","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164877","object_id":"column-164877","name":"iBillAmt_f","name_without_path":"iBillAmt_f","description":null,"is_pk":false,"is_identity":false,"data_type":"money","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164878","object_id":"column-164878","name":"Y_iOrderAmt_f","name_without_path":"Y_iOrderAmt_f","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"22, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164879","object_id":"column-164879","name":"Y_iBillAmt_f","name_without_path":"Y_iBillAmt_f","description":null,"is_pk":false,"is_identity":false,"data_type":"money","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164880","object_id":"column-164880","name":"iTotalAmt_f","name_without_path":"iTotalAmt_f","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"23, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164881","object_id":"column-164881","name":"iApplySum_f","name_without_path":"iApplySum_f","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"23, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164882","object_id":"column-164882","name":"fnatmoney","name_without_path":"fnatmoney","description":null,"is_pk":false,"is_identity":false,"data_type":"exmoney: decimal","data_length":"18, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164883","object_id":"column-164883","name":"fnatcreditmoney","name_without_path":"fnatcreditmoney","description":null,"is_pk":false,"is_identity":false,"data_type":"exmoney: decimal","data_length":"18, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164884","object_id":"column-164884","name":"iOrderAmt","name_without_path":"iOrderAmt","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"22, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164885","object_id":"column-164885","name":"iCmPreAmt","name_without_path":"iCmPreAmt","description":null,"is_pk":false,"is_identity":false,"data_type":"money","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164886","object_id":"column-164886","name":"iBillAmt","name_without_path":"iBillAmt","description":null,"is_pk":false,"is_identity":false,"data_type":"money","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164887","object_id":"column-164887","name":"Y_iOrderAmt","name_without_path":"Y_iOrderAmt","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"22, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164888","object_id":"column-164888","name":"Y_iBillAmt","name_without_path":"Y_iBillAmt","description":null,"is_pk":false,"is_identity":false,"data_type":"money","data_length":null,"is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164889","object_id":"column-164889","name":"iTotalAmt","name_without_path":"iTotalAmt","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"23, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]},{"id":"column-164890","object_id":"column-164890","name":"iApplySum","name_without_path":"iApplySum","description":null,"is_pk":false,"is_identity":false,"data_type":"decimal","data_length":"23, 6","is_nullable":true,"computed_formula":null,"default_value":null,"path":null,"level":1,"item_type":"COLUMN","is_user_defined":false,"custom_fields":{},"linked_terms":[],"references":[]}],"relations":[],"triggers":[],"unique_keys":[],"dependencies":null,"imported_at":"2024-07-15 13:47"};